process report {
  input :
   path(Base_annotation)
   path(vep)
   path(fasta_index)

  output : 
    path("*.html"), emit: html
    path("sgRNA_location*"), optional: true, emit: BAM
    path("*json*"), optional: true,  emit: report

 publishDir "${params.Report_output}/ancillary_files/", pattern: "sgRNA_location*", mode: "copy"
 publishDir "${params.Report_output}/ancillary_files/", pattern: "*.json", mode: "copy"
 publishDir "${params.Report_output}/", pattern: "*.html", mode: "copy"

     """
      source ${params.Python_env}
      report_script.py -c ${Base_annotation} -v *vep.txt
      bedToBam -i guides.bed -g ${fasta_index} > temp.bam
      samtools sort temp.bam -o sgRNA_location.bam
      rm temp.bam
      samtools index sgRNA_location.bam
      render_report.py --template ${projectDir}/assets/report_templates/report_template.txt --genome ${params.genome} --fasta_url "${params.fasta_url}" --fasta_index_url "${params.fasta_url}.fai" --fasta_gz_gzi "${params.fasta_url}.gzi" --gff3_url "${params.gff3_url}" --output report.html
      """
}
